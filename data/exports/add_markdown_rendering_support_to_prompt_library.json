{"title":"Add Markdown Rendering Support to Prompt Library","content":"## Objective\nAdd markdown rendering capabilities to the Prompt Library application so that prompt content is displayed with proper formatting (headings, lists, code blocks, etc.) instead of plain text. The markdown should be rendered in both the prompt cards and the modal view, with security measures to prevent XSS attacks.\n\n## Requirements\n\n### 1. Install Dependencies\nAdd markdown processing and HTML sanitization libraries:\n- `markdown2==2.4.10` - For converting markdown to HTML\n- `bleach==6.1.0` - For sanitizing HTML output\n\n### 2. Create Markdown Utility Module\nCreate `app/markdown_utils.py` with:\n- `render_markdown(text)` function that:\n  - Converts markdown to HTML using markdown2 with extras: fenced-code-blocks, tables, break-on-newline, code-friendly, cuddled-lists, strike, task_list\n  - Sanitizes HTML using bleach to prevent XSS attacks\n  - Allows safe HTML tags: headings, paragraphs, lists, code blocks, links, images, tables\n  - Returns empty string for None input\n- `markdown_filter(text)` function as Jinja2 filter wrapper\n- Define `ALLOWED_TAGS` and `ALLOWED_ATTRIBUTES` for bleach sanitization\n\n### 3. Update FastAPI Application (`app/main.py`)\n- Import markdown utilities: `markdown_filter` and `render_markdown`\n- Register `markdown_filter` as Jinja2 filter: `templates.env.filters['markdown'] = markdown_filter`\n- Update `/prompts/{prompt_id}/modal` endpoint to include `content_html` in JSON response (pre-rendered markdown)\n\n### 4. Add CSS Styling (`static/styles.css`)\nCreate comprehensive prose styling for markdown content:\n- Base prose class with proper typography (color, max-width)\n- Heading styles (h1-h4) with appropriate sizes, weights, and margins\n- Paragraph styling with line-height 1.6\n- List styles with proper indentation\n- Inline code: light gray background, monospace font\n- Code blocks: dark background (#1f2937), light text, rounded corners\n- Blockquote: left border, italic, muted color\n- Link styles with hover effects\n- Table styling with borders\n- Add `.line-clamp-6` utility class for card previews\n\n### 5. Update Prompt Card Template (`templates/components/prompt_card.html`)\n- Change content from `<p>` to `<div>`\n- Add classes: `prose prose-sm max-w-none`\n- Apply markdown filter: `{{ prompt.content | markdown | safe }}`\n- Keep click handler and hover effects\n\n### 6. Update Modal Template (`templates/components/prompt_modal.html`)\nIn view mode:\n- Change from `<pre>` with `x-text` to `<div>` with `x-html`\n- Add classes: `prose prose-lg max-w-none`\n- Bind to pre-rendered HTML: `x-html=\"currentPrompt?.content_html\"`\n- Remove font-sans and bg-transparent classes (handled by prose)\n\n## Expected Behavior\n- Prompt cards show markdown-formatted content preview (6 lines max)\n- Modal view mode displays full markdown-rendered content with proper styling\n- Edit mode continues to show raw markdown text\n- All HTML is sanitized to prevent security issues\n- Styling is consistent and readable with proper spacing\n\n## Technical Notes\n- Use `| safe` filter in Jinja2 to render HTML (content is already sanitized)\n- Alpine.js `x-html` directive renders HTML in modal\n- Pre-render markdown for modal JSON to avoid client-side processing\n- Prose classes ensure consistent typography across different markdown elements","created_at":"2025-11-17T13:57:01.716548","updated_at":"2025-11-17T13:57:59.658287","notes":[]}